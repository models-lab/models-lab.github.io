<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  Models & Languages  Lab


  | ModelSet - A dataset of software models for ML

</title>
<meta name="description" content="A research team interested in models and languages. 
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<!--
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">
-->



<link rel="shortcut icon" type="image/png" href="/assets/img/logo-small.png" >


<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="/blog/2021/modelset/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WTCT5KCNQV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'G-WTCT5KCNQV');
</script>




    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="/">
       <img style="margin-right: 10px" src="/assets/img/logo-small.png" /><span class="font-weight-bold">Models & Languages</span>   Lab
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              Home
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              Blog
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                Publications
                
              </a>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/team/">
                Team
                
              </a>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/software/">
                Software
                
              </a>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/contact/">
                Contact
                
              </a>
          </li>
          
          
          
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      

<div class="post">

  <header class="post-header">
    <h1 class="post-title">ModelSet - A dataset of software models for ML</h1>
    <p class="post-meta">November 19, 2021 • Jesús Sánchez Cuadrado</p>
  </header>

  <article class="post-content">
    <p>An important shortcoming of current approaches for applying Machine
Learning (ML) to address problems related to Model-Driven Engineering (MDE)
is the lack of curated datasets of software models. We believe that
there are several reasons for this, including the lack of
large collections of good quality models, the difficulty to label
models due to the required domain expertise, and the relative
immaturity of the application of ML to MDE.</p>

<p>To address this problem (at least partially), we created 
<strong>ModelSet</strong>, which is a dataset of software models intented to help in the application of machine learning techniques to solve modelling tasks. Its main features are the following:</p>

<ul>
  <li>
    <p>It contains more than 5,000 Ecore models (extracted from <a href="https://github.com/">GitHub</a>) and more than 5,000 UML models (extracted from <a href="https://www.genmymodel.com/">GenMyModel</a>).</p>
  </li>
  <li>
    <p>The models have been labelled with its category, which represents a type of models sharing a similar application domain. The following charts contain a summary of the main categories (yes! people like building <code class="language-plaintext highlighter-rouge">state machine</code> meta-models and UML models describing the <code class="language-plaintext highlighter-rouge">shopping</code> domain!).</p>
  </li>
</ul>

<p align="center">
  <img src="/assets/posts/modelset/category.svg" alt="Main categories in ModelSet" />
</p>

<ul>
  <li>In addition, ModelSet contains other labels which provides more semantic information. For instance, a model can be labelled with <code class="language-plaintext highlighter-rouge">category: statemachine</code>, an additional label with value <code class="language-plaintext highlighter-rouge">timed</code> to indicate its variant, and another one <code class="language-plaintext highlighter-rouge">teaching</code> to indicate that this particular model is being used for teaching purposes. In total, there are more than 28,000 labels.</li>
</ul>

<p align="center">
  <img src="/assets/posts/modelset/cloud.png" width="300px" alt="Tag cloud" />
</p>

<!-- We could add an example model with its annotations -->

<p>We foresee some <strong>potential applications</strong> ModelSet, like the following:</p>

<ul>
  <li>Classification approaches where labels are the target variables.</li>
  <li>Recommender systems (e.g., suggesting attribute names/types, etc.)</li>
  <li>Evaluation of clustering methods, in which the labels provide the ground truth about the clusters.</li>
  <li>Spurious model identification (i.e., using “dummy” labels)</li>
  <li>Evaluation of ML models via train-test-eval splitting in a stratified fashion using the labels.</li>
  <li>Train embeddings based on labels (i.e., for clone detection using the resulting vector).</li>
  <li>Empirical analysis of the modelling domain.</li>
</ul>

<p>Anyway, we are sure that any researcher/modeller interested in ML will find other interesting areas of application.</p>

<p>If you need a larger collection of models for unsupervised approaches, you can also checkout the models available at <a href="http://mar-search.org">MAR</a> (click on the Status tab), where you will find more than 500,000 models of different types, including Ecore, UML, Archimate, BPMN, etc.</p>

<p>The details of ModelSet have been presented in this paper (which is freely available):</p>

<ul>
  <li><a href="https://link.springer.com/article/10.1007/s10270-021-00929-3">José Antonio Hernández López, Javier Luis Cánovas Izquierdo, and Jesús Sánchez Cuadrado. “ModelSet: a dataset for machine learning in model-driven engineering.” Software and Systems Modeling (2021)</a></li>
</ul>

<p>In this post we will explain some practical details about ModelSet: its structure, how to install it, how to load the dataset and an illustrative example to address  classification task: inferring the category of a model.</p>

<h1 id="structure-of-the-dataset">Structure of the dataset</h1>

<p>The dataset basically consists of: a) the raw models, b) the databases with the labels and information about the models and c) alternative serializations of the models (e.g., as text files). Here is the structure that you will find when you unzip the package.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[+] datasets
    [+] dataset.ecore
        [+] data 
	        [+] ecore.db
		        - The database with the labels for the Ecore models
	        [+] analysis.db 
		        - Statistics about the Ecore models
    [+] dataset.genmymodel
	        [+] genmymodel.db
		        - The database with the labels for the UML models
	        [+] analysis.db
		        - Statistics about the UML models
[+] raw-data
    [+] repo-ecore-all
        - The .ecore models that has been labelled
    [+] repo-genmymodel-uml
        - The UML models that has been labelled, stored as .xmi files 
[+] txt
    - A mirror of raw-data but with 1-gram encoding of the models,
	  that is for each model a textual file with the strings of the model.
</code></pre></div></div>

<p>The databases are just SQLite databases that you can manipulate using any SQLite connector (e.g., in Java or Python). 
The <code class="language-plaintext highlighter-rouge">ecore.db</code> and <code class="language-plaintext highlighter-rouge">genmymodel.db</code> files contain the databases with the labels associated to the models. You can open it with the <code class="language-plaintext highlighter-rouge">sqlite</code> command and the main part of the schema is simply:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span> <span class="k">schema</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">models</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">repo</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">filename</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">metadata</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">metadata</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">json</span> <span class="nb">text</span>
<span class="p">);</span>
</code></pre></div></div>

<p>The labels are stored in the <code class="language-plaintext highlighter-rouge">metadata</code> table, specifically the <code class="language-plaintext highlighter-rouge">metadata</code> column contains the labels as entered by the user who performed the labelling).
To facilitate its processing the <code class="language-plaintext highlighter-rouge">json</code> column contains a JSON representation of the labels. For instance, the following shows the labels in a model <code class="language-plaintext highlighter-rouge">FaultTree.ecore</code> serialized in JSON.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> 
  </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fault-tree"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"safety"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hazard"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"tool"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"osate2"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>It is possible to directly interact with the SQLite database to perform exploratory queries. For instance, the following query shows the number of models per category in the Ecore database. It uses the <code class="language-plaintext highlighter-rouge">json_extract</code> function to query the associated JSON that contains the metadata.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">sqlite</span> <span class="n">datasets</span><span class="o">/</span><span class="n">dataset</span><span class="p">.</span><span class="n">ecore</span><span class="o">/</span><span class="n">ecore</span><span class="p">.</span><span class="n">db</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">json_extract</span><span class="p">(</span><span class="n">md</span><span class="p">.</span><span class="n">json</span><span class="p">,</span> <span class="s1">'$.category[0]'</span><span class="p">)</span> <span class="k">as</span> <span class="n">category</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">total</span>
  <span class="k">from</span> <span class="n">models</span> <span class="n">m</span> <span class="k">join</span> <span class="n">metadata</span> <span class="n">md</span> <span class="k">on</span> <span class="n">m</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">id</span>
  <span class="k">group</span> <span class="k">by</span> <span class="n">category</span>
  <span class="k">order</span> <span class="k">by</span> <span class="n">total</span> <span class="k">desc</span><span class="p">;</span>

<span class="n">category</span>     <span class="n">total</span>
<span class="c1">--------     -----</span>
<span class="n">dummy</span>         <span class="mi">729</span>
<span class="n">statemachine</span>  <span class="mi">392</span>
<span class="n">petrinet</span>      <span class="mi">236</span>
<span class="n">library</span>       <span class="mi">235</span>
<span class="n">modelling</span>     <span class="mi">209</span>
<span class="k">class</span><span class="o">-</span><span class="n">diagram</span> <span class="mi">182</span>
<span class="n">gpl</span>           <span class="mi">180</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">analysis.db</code> database has the same schema as the databases provided by <a href="http://mar-search.org">MAR</a>. It contains statistics about the model. In the case of the Ecore dataset, it also contains information about design smells found in each model.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">sqlite3</span> <span class="n">repo</span><span class="o">-</span><span class="n">github</span><span class="o">-</span><span class="n">ecore</span><span class="o">/</span><span class="n">analysis</span><span class="p">.</span><span class="n">db</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span> <span class="k">schema</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">models</span> <span class="p">(</span>
    <span class="n">id</span>            <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">relative_file</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">hash</span>          <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">status</span>        <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">metadata_document</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">duplicate_of</span>  <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">stats</span> <span class="p">(</span>
    <span class="n">id</span>    <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">type</span>  <span class="nb">varchar</span> <span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">count</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
</code></pre></div></div>

<p>The following query shows statistics about the models in the Ecore dataset. <code class="language-plaintext highlighter-rouge">elements</code> refers to the total number of elements, and the other types refers to meta-elements (e.g., EAttribute, EClass, etc.).</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">type</span><span class="p">,</span> <span class="k">avg</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">from</span> <span class="n">stats</span> <span class="k">group</span> <span class="k">by</span> <span class="k">type</span><span class="p">;</span>
<span class="k">type</span>        <span class="k">avg</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> 
<span class="c1">----------  ----------</span>
<span class="n">attributes</span>     <span class="mi">16</span><span class="p">.</span><span class="mi">31</span>
<span class="n">classes</span>        <span class="mi">25</span><span class="p">.</span><span class="mi">74</span>
<span class="n">datatypes</span>       <span class="mi">1</span><span class="p">.</span><span class="mi">23</span>
<span class="n">elements</span>      <span class="mi">206</span><span class="p">.</span><span class="mi">32</span>
<span class="nb">enum</span>            <span class="mi">1</span><span class="p">.</span><span class="mi">24</span>
<span class="n">packages</span>        <span class="mi">1</span><span class="p">.</span><span class="mi">46</span>
<span class="k">references</span>     <span class="mi">26</span><span class="p">.</span><span class="mi">82</span>
</code></pre></div></div>

<h1 id="example">Example</h1>

<p>In the rest of the post we will develop a concrete example, using ModelSet
to build a classifier able to infer the category of a given Ecore model.
We will use the <a href="http://github.com/modelset/modelset-py">ModelSet Python library</a> to access the dataset and <a href="https://pandas.pydata.org/">pandas</a> and <a href="https://scikit-learn.org">scikit-learn</a> to manipulate the dataset and train the model.</p>

<p>The implementation of this example is available in our repository of
ModelSet examples. You can download it <a href="https://github.com/modelset/modelset-apps/blob/master/python/modelset-tutorial-categories.ipynb">here</a>.</p>

<h2 id="installation">Installation</h2>

<p>First of all, you need to download and install ModelSet.</p>

<ol>
  <li>Download the package containing the raw models and the associated databases. Available at <a href="https://github.com/modelset/modelset-dataset/releases">https://github.com/modelset/modelset-dataset/releases</a>.</li>
  <li>Unzip the package in some local folder</li>
  <li>Install the Python library using pip. This will allow us to easily use ModelSet with standard ML libraries.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">pip install modelset-py</code></li>
      <li>If you have downloaded the source code of the library from <a href="http://github.com/modelset/modelset-py">GitHub repository</a> ,
then use <code class="language-plaintext highlighter-rouge">sys.path.append("/path/to/modelset-py/src")</code> as a shortcut to load it dynamically.</li>
    </ul>
  </li>
</ol>

<h2 id="loading-the-dataset">Loading the dataset</h2>

<p>The ModelSet library offers a convenient interface to dump the contents of the underlying database into a dataframe. In particular, there are several features available in the output dataframe:</p>

<ul>
  <li>The identifier of the model</li>
  <li>The category of the model (manually labelled). Reflects the domain of the model.</li>
  <li>Associated tags (zero or more manually labelled) which provide additional insights about the type of model.</li>
  <li>The language of the model (typically english)</li>
  <li>Basic stats. In the case of Ecore, number of elements, references, classes, attributes, packages, enumerations and datatypes</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">os</span>

<span class="kn">import</span> <span class="n">modelset.dataset</span> <span class="k">as</span> <span class="n">ds</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">MODELSET_HOME</span><span class="p">,</span> <span class="n">modeltype</span> <span class="o">=</span> <span class="s">'ecore'</span><span class="p">,</span> <span class="n">selected_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="s">'stats'</span><span class="p">])</span>
<span class="c1"># You can just use: ds.load(MODELSET_HOME, modeltype = 'ecore') to speedup the loading if you don't need the stats
</span></code></pre></div></div>

<p>Convert the dataset into a Pandas dataframe. There are two methods:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">to_df()</code> converts the complete dataset.</li>
  <li><code class="language-plaintext highlighter-rouge">to_normalized_df()</code> only considers examples with a minimum number of examples (7 by default), written in english and removing special categories (dummy and unknown).</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">modelset_df</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="nf">to_normalized_df</span><span class="p">()</span>
<span class="c1"># You can configure the elements of the dataframe:
# modelset_df = dataset.to_normalized_df(min_ocurrences_per_category = 7, languages = ['english'], remove_categories = ['dummy', 'unknown'])
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">modelset_df</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>category</th>
      <th>tags</th>
      <th>language</th>
      <th>references</th>
      <th>elements</th>
      <th>classes</th>
      <th>attributes</th>
      <th>packages</th>
      <th>enum</th>
      <th>datatypes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>repo-ecore-all/data/AmerPecuj/MBSE/dk.dtu.comp...</td>
      <td>petrinet</td>
      <td>behaviour</td>
      <td>english</td>
      <td>7</td>
      <td>27</td>
      <td>6</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>repo-ecore-all/data/nlohmann/service-technolog...</td>
      <td>petrinet</td>
      <td>behaviour</td>
      <td>english</td>
      <td>13</td>
      <td>92</td>
      <td>15</td>
      <td>16</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>repo-ecore-all/data/damenac/puzzle/examples/em...</td>
      <td>education</td>
      <td>domainmodel</td>
      <td>english</td>
      <td>4</td>
      <td>37</td>
      <td>4</td>
      <td>12</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>repo-ecore-all/data/francoispfister/diagraph/o...</td>
      <td>statemachine</td>
      <td>behaviour</td>
      <td>english</td>
      <td>7</td>
      <td>87</td>
      <td>9</td>
      <td>13</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>repo-ecore-all/data/gssi/metamodelsdataset-ECM...</td>
      <td>petrinet</td>
      <td>behaviour</td>
      <td>english</td>
      <td>3</td>
      <td>17</td>
      <td>4</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>5468</th>
      <td>repo-ecore-all/data/Barros-Lucas/DSL_State_Int...</td>
      <td>statemachine</td>
      <td>behaviour</td>
      <td>english</td>
      <td>3</td>
      <td>22</td>
      <td>5</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5469</th>
      <td>repo-ecore-all/data/luciuscode/test/projectStr...</td>
      <td>library</td>
      <td>domainmodel</td>
      <td>english</td>
      <td>4</td>
      <td>34</td>
      <td>6</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5470</th>
      <td>repo-ecore-all/data/BlackBeltTechnology/emfbui...</td>
      <td>company</td>
      <td>NaN</td>
      <td>english</td>
      <td>2</td>
      <td>22</td>
      <td>5</td>
      <td>4</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5473</th>
      <td>repo-ecore-all/data/mathiasnh/TDT4250-Assignme...</td>
      <td>education</td>
      <td>university|domainmodel</td>
      <td>english</td>
      <td>24</td>
      <td>101</td>
      <td>11</td>
      <td>12</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5474</th>
      <td>repo-ecore-all/data/agacek/jkind-xtext/jkind.x...</td>
      <td>simple-pl</td>
      <td>expressions|types|lustre|programming</td>
      <td>english</td>
      <td>55</td>
      <td>214</td>
      <td>44</td>
      <td>14</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>4230 rows × 11 columns</p>
</div>

<h2 id="spliting-the-dataset">Spliting the dataset</h2>

<p>To train our model we are interested on the category attribute, which will be our target variable (the label that we want to predict) and we are going to use the model identifiers as input data because we will use them to lookup the corresponding textual representation (see below).</p>

<p>We need to split our dataset into training and test, so that we can evaluate later the accuracy of our model.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># These dataframes are vectors
</span><span class="n">ids</span>     <span class="o">=</span> <span class="n">modelset_df</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span>
<span class="n">labels</span>  <span class="o">=</span> <span class="n">modelset_df</span><span class="p">[</span><span class="s">'category'</span><span class="p">]</span>

<span class="n">train_X</span><span class="p">,</span> <span class="n">test_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="nf">train_test_split</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="selecting-features">Selecting features</h2>

<p>A neural networks takes an input a numerical vector. So, we need a way to encode a model into a vector. A simple way is to use a TF-IDF encoding. Essentially, <a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">TF-IDF</a> is a measure of the relevance of a word by comparing the number of times that a word appears in a document with respect to the number of documents in which the word appears.</p>

<p>To apply TF-IDF, the first thing that we need to do is to extract a textual representation of each model. We use the <code class="language-plaintext highlighter-rouge">txt_file</code> method to obtain the path to the text file associated with a given model. This is a feature provided by ModelSet: for each model there is already <code class="language-plaintext highlighter-rouge">.txt</code> which contains its 1-gram (i.e., the values of the string attributes).</p>

<p>Then, we can easily compute the TF-IDF using scikit-learn. The <code class="language-plaintext highlighter-rouge">X</code> and <code class="language-plaintext highlighter-rouge">T</code> matrices contain one row per model with a number of columns equals to the number of words in the models.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span> 
<span class="kn">from</span> <span class="n">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<span class="kn">from</span> <span class="n">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="n">train_filenames</span> <span class="o">=</span> <span class="p">[</span> <span class="n">dataset</span><span class="p">.</span><span class="nf">txt_file</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">train_X</span> <span class="p">]</span>
<span class="n">test_filenames</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">dataset</span><span class="p">.</span><span class="nf">txt_file</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">test_X</span> <span class="p">]</span>

<span class="n">vectorizer</span> <span class="o">=</span> <span class="nc">TfidfVectorizer</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="s">'filename'</span><span class="p">,</span> <span class="n">min_df</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">train_filenames</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">test_filenames</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># The output of the TF-IDF vectorization is a large matrix with len(train_X) rows and 
# as many columns as words in the vocabulary
</span><span class="n">X</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(3384, 24810)
</code></pre></div></div>

<h2 id="training">Training</h2>

<p>We use a neural network with one hidden layer as our model. This is straightforward with scikit-learn.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>

<span class="c1">#input_layer = X.shape[1]
</span><span class="n">clf</span> <span class="o">=</span> <span class="nc">MLPClassifier</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s">'adam'</span><span class="p">,</span> <span class="n">learning_rate_init</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">clf</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="evaluation">Evaluation</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span><span class="n">confusion_matrix</span>
</code></pre></div></div>

<p>First, we evaluate the results obtained in the training set. In particular, we focus on the accuracy (the fraction of correctly classified examples).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predict_train</span> <span class="o">=</span> <span class="n">clf</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="c1"># print(confusion_matrix(train_y, predict_train))
</span><span class="n">train_report</span> <span class="o">=</span> <span class="nf">classification_report</span><span class="p">(</span><span class="n">train_y</span><span class="p">,</span> <span class="n">predict_train</span><span class="p">,</span> <span class="n">output_dict</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">"Training accuracy: "</span><span class="p">,</span> <span class="n">train_report</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Training accuracy:  0.9994089834515366
</code></pre></div></div>

<p>Then, we evaluate the classifier over the test set. As can be seen the results are good, and in principle, we can assume that our model is ok and we can use it in practice.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predict_test</span> <span class="o">=</span> <span class="n">clf</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">test_report</span> <span class="o">=</span> <span class="nf">classification_report</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="n">predict_test</span><span class="p">,</span> <span class="n">output_dict</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">"Test accuracy: "</span><span class="p">,</span> <span class="n">test_report</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Test accuracy:  0.9030732860520094
</code></pre></div></div>

<h1 id="practical-usage">Practical usage</h1>

<p>We have used ModelSet to enhance the <a href="http://mar-search.org">MAR search engine</a>. In particular, we use the model described above to
infer the the category of the models shown as search results.
In the image below the dropdown menu allows the user to filter the search results (label 1) and the little badges (label 2) are the categories and tags inferred per each model.</p>

<p>There are more than 17,000 Ecore models in MAR, so it is not feasiable to label all of them by hand. We have used the a ML model as the one trained in the example to infer the category of each model and so generate the associated badge.</p>

<p align="center">
  <img src="/assets/posts/modelset/mar.png" width="800px" alt="MAR" />
</p>

<h1 id="conclusion">Conclusion</h1>

<p>This ends this introduction to ModelSet. The main goal has been to present it and to help potential users get started. There is still additional work to do, like labelling more models (see our <a href="https://twitter.com/modelsetbot">Twitter bot</a> if you want to help!) and building more examplary applications.
Anyway, we hope that this is already a useful resource for the community.</p>

  </article>

  

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    &copy; Copyright 2023 Models & Languages  Lab.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.

    
    
    Last updated: July 09, 2023.
    
  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
